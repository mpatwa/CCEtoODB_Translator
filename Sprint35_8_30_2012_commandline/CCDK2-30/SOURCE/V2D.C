/* -2 -3 */
/********************************* V2D.C ***********************************/
/***************** Display of 2-dim geometry in a viewport *****************/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
#include <c2cdefs.h>
#include <grrdefs.h>
#include <v2ddefs.h>
#include <v2dpriv.h>
#include <c2vmcrs.h>
#include <vpmcrs.h>

STATIC  void    v2d_buffer __(( PT2*, INT, VP_VIEWPORT )) ;

/*-------------------------------------------------------------------------*/
BBS_PUBLIC void v2d_set_textposition ( pt, vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 pt ;
VP_VIEWPORT vp ;
{
    PT2 p ;

    V2D_PT_TRANSFORM ( pt, vp, p ) ;
    grr_set_textposition ( p ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC void v2d_moveto ( pt, vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 pt ;
VP_VIEWPORT vp ;
{
    PT2 p ;
    V2D_PT_TRANSFORM ( pt, vp, p ) ;
    grr_moveto ( p ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC void v2d_lineto ( pt, vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 pt ;
VP_VIEWPORT vp ;
{
    PT2 p ;
    v2d_moveto ( VP_VIEWPORT_PREV_PT(vp), vp ) ;
    V2D_PT_TRANSFORM ( pt, vp, p ) ;
    grr_lineto ( p ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC void v2d_curve ( curve, parm0, parm1, vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_CURVE curve ;
PARM parm0, parm1 ;
VP_VIEWPORT vp ;
{
    c2c_display ( curve, parm0, parm1, VP_VIEWPORT_GRAN(vp), 
        VP_VIEWPORT_VIEW_CTR_PT(vp), 
        2.0 * ( C2V_NORML1 ( VP_VIEWPORT_VIEW_X_VEC(vp) ) +  
        C2V_NORML1 ( VP_VIEWPORT_VIEW_Y_VEC(vp) ) ), 
        (PF_DISPLAY)v2d_buffer, vp ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC void v2d_curvelist ( curvelist, vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
DML_LIST curvelist ;
VP_VIEWPORT vp ;
{
    DML_ITEM item ;
    DML_WALK_LIST ( curvelist, item ) 
        v2d_curve ( DML_RECORD(item), NULL, NULL, vp ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC void v2d_point ( pt, size, vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 pt ;
REAL size ;
VP_VIEWPORT vp ;
{
    PT2 p ;

    V2D_PT_TRANSFORM ( pt, vp, p ) ;
    grr_point ( p, size ) ;
}


/*-------------------------------------------------------------------------*/
STATIC void v2d_buffer ( a, n, vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 *a  ;
INT n ;
VP_VIEWPORT vp ;
{
    PT2 p ;
    INT i ;

    if ( n > 1 ) {
        v2d_pt_transform ( a[0], vp, p ) ;
        grr_moveto ( p ) ;
        for ( i=1 ; i<n ; i++ ) {
            v2d_pt_transform ( a[i], vp, p ) ;
            grr_lineto ( p ) ;
        }
    }
}            


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void v2d_pt_transform ( a, vp, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a ;
VP_VIEWPORT vp ;
PT2 b ;
{
    b[0] = VP_VIEWPORT_TRANSFORM(vp)[0][0] * a[0] + 
        VP_VIEWPORT_TRANSFORM(vp)[0][1] * a[1] + 
        VP_VIEWPORT_TRANSFORM(vp)[0][3] ;
    b[1] = VP_VIEWPORT_TRANSFORM(vp)[1][0] * a[0] + 
        VP_VIEWPORT_TRANSFORM(vp)[1][1] * a[1] + 
        VP_VIEWPORT_TRANSFORM(vp)[1][3] ;
    if ( !VP_VIEWPORT_CLIPPED(vp) ) {
        b[0] += VP_VIEWPORT_PX0(vp) ; 
        b[1] += VP_VIEWPORT_PY0(vp) ;
    }
    VP_VIEWPORT_PREV_X(vp) = a[0] ;
    VP_VIEWPORT_PREV_Y(vp) = a[1] ;
}            

