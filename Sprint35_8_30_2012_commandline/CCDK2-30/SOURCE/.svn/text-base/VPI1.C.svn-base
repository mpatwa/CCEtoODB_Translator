/* -2 -3 */
/********************************* VPI1.C **********************************/
/********************** Display viewports management ***********************/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/

#include <aladefs.h>
#include <c2adefs.h>
#include <grrdefs.h>
#include <vpidefs.h>
#include <vpvdefs.h>
#include <c2vmcrs.h>
#include <vpmcrs.h>
#define     NORM(A)     (sqrt((A)[0]*(A)[0]+(A)[1]*(A)[1]+(A)[2]*(A)[2]))

/*-------------------------------------------------------------------------*/
BBS_PUBLIC VP_VIEWPORT vpi_restore ( vp, buffer ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
ANY buffer ;
{
    grr_putimage ( VP_VIEWPORT_PX0(vp), VP_VIEWPORT_PY0(vp), buffer ) ;
    FREE ( buffer ) ;
    RETURN ( vp ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC ANY vpi_save ( vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
{
    RETURN ( grr_getimage ( VP_VIEWPORT_PX0(vp), VP_VIEWPORT_PY0(vp), 
            VP_VIEWPORT_PX1(vp), VP_VIEWPORT_PY1(vp) ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC VP_VIEWPORT vpi_set_wh ( vp, w, h )
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
REAL w, h ; 
{
    if ( w > BBS_ZERO ) {
        w *= ( 0.5 / NORM ( VP_VIEWPORT_VIEW_X_VEC(vp) ) ) ;
        VP_VIEWPORT_VIEW_X_VEC(vp)[0] *= w ;
        VP_VIEWPORT_VIEW_X_VEC(vp)[1] *= w ;
        VP_VIEWPORT_VIEW_X_VEC(vp)[2] *= w ;
    }
    if ( h > BBS_ZERO ) {
        h *= ( 0.5 / NORM ( VP_VIEWPORT_VIEW_Y_VEC(vp) ) ) ; 
        VP_VIEWPORT_VIEW_Y_VEC(vp)[0] *= h ;
        VP_VIEWPORT_VIEW_Y_VEC(vp)[1] *= h ;
        VP_VIEWPORT_VIEW_Y_VEC(vp)[2] *= h ;
    }
    vpi_setup ( vp ) ;
    RETURN ( vp ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC void vpi_get_screen_box ( vp, p0, p1 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
PT2 p0, p1 ;
{
    C2V_COPY ( VP_VIEWPORT_MIN_PT(vp), p0 ) ;
    C2V_COPY ( VP_VIEWPORT_MAX_PT(vp), p1 ) ;
}


/*-------------------------------------------------------------------------*/ 
BBS_PUBLIC VP_VIEWPORT vpi_set_screen_box ( vp, p0, p1 ) 
/*-------------------------------------------------------------------------*/ 
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/ 
/*!!!!!!!!                                                          !!!!!!!*/ 
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/ 
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/ 
VP_VIEWPORT vp ; 
PT2 p0, p1 ; 
{ 
    C2V_COPY ( p0, VP_VIEWPORT_MIN_PT(vp) ) ; 
    C2V_COPY ( p1, VP_VIEWPORT_MAX_PT(vp) ) ; 
    RETURN ( vpi_setup ( vp ) ) ; 
} 


/*-------------------------------------------------------------------------*/
BBS_PUBLIC VP_VIEWPORT vpi_set_bk_color ( vp, bk_color ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
GR_COLOR bk_color ;
{
    VP_VIEWPORT_BK_COLOR(vp) = bk_color ;
    RETURN ( vp ) ;
}

/*-------------------------------------------------------------------------*/
BBS_PUBLIC VP_VIEWPORT vpi_set_bd_color ( vp, bd_color ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
GR_COLOR bd_color ;
{
    VP_VIEWPORT_BD_COLOR(vp) = bd_color ;
    RETURN ( vp ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC GR_COLOR vpi_get_bk_color ( vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
{
    RETURN ( VP_VIEWPORT_BK_COLOR(vp) ) ;
}

/*-------------------------------------------------------------------------*/
BBS_PUBLIC GR_COLOR vpi_get_bd_color ( vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
{
    RETURN ( VP_VIEWPORT_BD_COLOR(vp) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC VP_VIEWPORT vpi_copy ( vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
{
    RETURN ( vpi_create ( VP_VIEWPORT_VIEW_CTR_PT(vp), 
        VP_VIEWPORT_VIEW_X_VEC(vp), VP_VIEWPORT_VIEW_Y_VEC(vp), 
        VP_VIEWPORT_PX0(vp), VP_VIEWPORT_PY0(vp), 
        VP_VIEWPORT_PX1(vp), VP_VIEWPORT_PY1(vp), 
        VP_VIEWPORT_BD_COLOR(vp), VP_VIEWPORT_BK_COLOR(vp) ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC BOOLEAN vpi_overlap ( vp1, vp2 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp1, vp2 ;
{
    RETURN ( c2a_box_w_overlap ( VP_VIEWPORT_SCREEN_BOX(vp1), 
        VP_VIEWPORT_SCREEN_BOX(vp2), BBS_ZERO ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC VP_VIEW vpi_save_view ( vp ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
{
    VP_VIEW view = vpv_create () ;
    vpv_copy ( VP_VIEWPORT_VIEW(vp), view ) ;
    RETURN ( view ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC VP_VIEWPORT vpi_set_view ( vp, view ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
VP_VIEW view ; 
{
    vpv_copy ( VP_VIEWPORT_VIEW(vp), view ) ;
    RETURN ( vp ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC VP_VIEWPORT vpi_set_transform ( vp, t ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
VP_TRANSFORM t ;
{
    ala_copy ( (REAL*)t, sizeof(VP_TRANSFORM)/sizeof(REAL), 
        (REAL*)VP_VIEWPORT_TRANSFORM(vp) ) ;
    RETURN ( vp ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL vpi_get_select_width ( vp )
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!(C) Copyright 1989 - 1995 Building Block Software    !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
VP_VIEWPORT vp ;
{
    RETURN ( GR_SELECT_WIDTH * ( grr_get_max_x() + grr_get_max_y() ) * 
        VP_VIEWPORT_GRAN(vp) ) ;
}

