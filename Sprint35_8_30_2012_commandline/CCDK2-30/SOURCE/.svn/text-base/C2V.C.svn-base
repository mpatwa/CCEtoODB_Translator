/* -2 -3 */
/********************************** C2V.C **********************************/
/*************************** 2d vector geometry ****************************/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
#include <c2vdefs.h>
#include <c2vpriv.h>
#include <c2vmcrs.h>

/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*     c2v_set_zero(a) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a ;
{
    a[0] = 0.0 ;
    a[1] = 0.0 ;
    RETURN ( a ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*    c2v_set(x,y,a) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
REAL x, y ;
PT2 a ;
{
    a[0] = x ;
    a[1] = y ;
    RETURN ( a ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*     c2v_copy(a,b)
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
{
    b[0] = a[0] ;
    b[1] = a[1] ;
    RETURN ( b ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL        c2v_dist_squared ( a, b )   
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
{
    PT2 c ;
    C2V_SUB ( b, a, c ) ;
    RETURN ( c[0]*c[0] + c[1]*c[1] ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC BOOLEAN     c2v_normalize ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
{
    REAL norm ;
    norm = C2V_NORML1 ( a ) ;
    if ( norm <= BBS_ZERO ) 
        RETURN ( FALSE ) ;
    b[0] = a[0] / norm ;
    b[1] = a[1] / norm ;
    norm = C2V_NORM ( b ) ;
    b[0] = b[0] / norm ;
    b[1] = b[1] / norm ;
    RETURN ( TRUE ) ;
}    


/*-------------------------------------------------------------------------*/
BBS_PUBLIC BOOLEAN     c2v_normalize_l1 ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
{
    REAL norm ;
    norm = C2V_NORML1 ( a ) ;
    if ( norm <= BBS_TOL ) 
        RETURN ( FALSE ) ;
    b[0] = a[0] / norm ;
    b[1] = a[1] / norm ;
    RETURN ( TRUE ) ;
}    


/*-------------------------------------------------------------------------*/
BBS_PUBLIC BOOLEAN c2v_vecs_parallel ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
{
    REAL cross ;
    cross = C2V_CROSS ( a, b ) ;
    if ( cross < 0.0 ) 
        cross = - cross ;
    RETURN ( cross <= BBS_ZERO * C2V_NORML1(a) * C2V_NORML1(b) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL    c2v_vecs_sin ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
{
    RETURN ( C2V_CROSS ( a, b ) / ( C2V_NORM(a) * C2V_NORM(b) ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL    c2v_vecs_cos ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
{
    RETURN ( C2V_DOT ( a, b ) / ( C2V_NORM(a) * C2V_NORM(b) ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL    c2v_vecs_angle ( a, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
{
    REAL c, s ;
    c = C2V_DOT ( a, b ) ;
    s = C2V_CROSS ( a, b ) ;
    RETURN ( bbs_atan2 ( s, c ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL    c2v_atan2 ( x ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 x ;
{
    PT2 y ;
    RETURN ( c2v_normalize ( x, y ) ? bbs_atan2 ( y[1], y[0] ) : 0.0 ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC BOOLEAN c2v_vec_between ( v0, v1, v ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 v0, v1, v ;
{
    if ( C2V_CROSS ( v0, v1 ) > 0.0 ) 
        RETURN ( C2V_CROSS ( v0, v ) > 0.0 && C2V_CROSS ( v, v1 ) > 0.0 ) ;
    else if ( C2V_CROSS ( v0, v1 ) < 0.0 ) 
        RETURN ( C2V_CROSS ( v0, v ) < 0.0 && C2V_CROSS ( v, v1 ) < 0.0 ) ;
    else
        RETURN ( TRUE ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*     c2v_rotate_vec ( a, angle, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
REAL angle ;
{
    REAL c, s ;
    c = cos ( angle ) ;
    s = sin ( angle ) ;
    RETURN ( c2v_rotate_vec_cs ( a, c, s, b ) ) ;
}

/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*     c2v_rotate_vec_cs ( a, c, s, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b ;
REAL c, s ;
{
    PT2 a1 ;
    C2V_COPY ( a, a1 ) ;
    b[0] = a1[0] * c - a1[1] * s ;
    b[1] = a1[0] * s + a1[1] * c ;
    RETURN ( b ) ;
}

/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*     c2v_rotate_pt ( a, origin, angle, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, origin, b ;
REAL angle ;
{
    REAL c, s ;
    c = cos ( angle ) ;
    s = sin ( angle ) ;
    RETURN ( c2v_rotate_pt_cs ( a, origin, c, s, b ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*     c2v_rotate_pt_cs ( a, origin, c, s, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, origin, b ;
REAL c, s ;
{
    PT2 a1 ;
    C2V_SUB ( a, origin, a1 ) ;
    C2V_ROTATE_VEC_CS ( a1, c, s, b ) ;
    C2V_ADD ( b, origin, b ) ;
    RETURN ( b ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*   c2v_mirror_pt ( a, origin, normal, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, origin, normal, b ;
{
    PT2 a1 ;
    REAL dot ;

    C2V_SUB ( a, origin, a1 ) ;
    dot = - 2.0 * C2V_DOT ( a1, normal ) ;
    C2V_ADDT ( a, normal, dot, b ) ;
    RETURN ( b ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL*   c2v_mirror_vec ( a, normal, b ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, normal, b ;
{
    PT2 a1 ;
    REAL dot ;

    C2V_COPY ( a, a1 ) ;
    dot = - 2.0 * C2V_DOT ( a1, normal ) ;
    C2V_ADDT ( a, normal, dot, b ) ;
    RETURN ( b ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL c2v_area ( a, b, c ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b, c ;
{
    RETURN ( a[0] * b[1] - a[1] * b[0] + b[0] * c[1] - b[1] * c[0] + 
        c[0] * a[1] - c[1] * a[0] ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL c2v_project_line ( a, b, c, p ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a, b, c, p ;
{
    PT2 u, v ;
    REAL t ;

    C2V_SUB ( b, a, u ) ;
    C2V_SUB ( c, a, v ) ;
    t = C2V_DOT ( u, v ) / C2V_DOT ( u, u ) ;
    if ( p!= NULL ) 
        C2V_ADDT ( a, u, t, p ) ;
    RETURN ( t ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC INT c2v_side ( a, b, vec ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*********************** side = sign ( ( a - b ) x vec ) *******************/
PT2    a, b, vec ;    /* Points and direction */
{
    PT2 v ;
    REAL cross ;

    C2V_SUB ( a, b, v ) ;
    cross = C2V_CROSS ( v, vec ) ;
    if ( cross > BBS_TOL ) 
        RETURN ( 1 ) ;
    else if ( cross < -BBS_TOL ) 
        RETURN ( -1 ) ;
    else 
        RETURN ( 0 ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void c2v_coord ( a0, a1, pt, u_ptr, v_ptr ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 a0, a1, pt ;
REAL *u_ptr, *v_ptr ;
{
    PT2 x, y ;
    REAL n ;

    C2V_SUB ( a1, a0, x ) ;
    C2V_SUB ( pt, a0, y ) ;
    n = C2V_DOT ( x, x ) ;
    *u_ptr = C2V_DOT ( x, y ) / n ;
    *v_ptr = C2V_CROSS ( x, y ) / n ;
}

