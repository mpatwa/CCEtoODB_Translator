/* -2 -3 */
/************************************* C2AB.C ******************************/
/***************** Arrays of two-dimensional homogeneous points ************/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                     All rights reserved                  !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
#include <c2adefs.h>
#include <c2apriv.h>
#include <c2vmcrs.h>

STATIC  BOOLEAN c2ab_box_overlap __(( C2_BOX DUMMY0 , C2_BOX DUMMY1 , 
            REAL DUMMY2 )) ;

/*----------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX c2a_box ( min_pt, max_pt ) 
/*----------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                      !!!!!!!!*/
/*!!!!!!!!     (C) Copyright 1989 - 1995 Building Block Software!!!!!!!!*/
/*!!!!!!!!                   All rights reserved                !!!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 min_pt, max_pt ;
{
    C2_BOX box ;

    box = (C2_BOX)dmm_malloc ( sizeof ( C2_BOX_S ) ) ;
    if ( box == NULL ) 
        RETURN ( NULL ) ;
    C2V_COPY ( min_pt, C2_MIN_PT(box) ) ;
    C2V_COPY ( max_pt, C2_MAX_PT(box) ) ;
    RETURN ( box ) ;
}


/*----------------------------------------------------------------------*/
BBS_PUBLIC void c2a_free_box ( box ) 
/*----------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                      !!!!!!!!*/
/*!!!!!!!!     (C) Copyright 1989 - 1995 Building Block Software!!!!!!!!*/
/*!!!!!!!!                   All rights reserved                !!!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
{
    dmm_free ( box ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL c2a_box_size ( box ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
{
    RETURN ( box == NULL ? 0.0 : 
        C2V_DISTL1 ( C2_MIN_PT(box), C2_MAX_PT(box) ) ) ;
}



/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL c2a_box_width ( box ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
{
    RETURN ( fabs ( C2_MAX_X(box) - C2_MIN_X(box) ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL c2a_box_height ( box ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
{
    RETURN ( fabs ( C2_MAX_Y(box) - C2_MIN_Y(box) ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC REAL* c2a_box_get_ctr ( box, ctr ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
PT2 ctr ;
{
    C2V_MID_PT ( C2_MIN_PT(box), C2_MAX_PT(box), ctr ) ;
    RETURN ( ctr ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX c2a_box_set_ctr_wh ( box, ctr, w, h ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
PT2 ctr ;
REAL w, h ;
{
    w = 0.5*fabs(w) ;
    h = 0.5*fabs(h) ;
    if ( ctr == NULL ) {
        C2_MIN_X(box) = (-w) ;
        C2_MAX_X(box) = w ;
        C2_MIN_Y(box) = (-h) ;
        C2_MAX_Y(box) = h ;
    }
    else {
        C2_MIN_X(box) = ctr[0] - w ;
        C2_MAX_X(box) = ctr[0] + w ;
        C2_MIN_Y(box) = ctr[1] - h ;
        C2_MAX_Y(box) = ctr[1] + h ;
    }
    RETURN ( box ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC BOOLEAN c2a_box_overlap ( box1, box2 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/

C2_BOX box1, box2 ;
{
    RETURN ( c2ab_box_overlap ( box1, box2, BBS_TOL ) ) ;
}

/*-------------------------------------------------------------------------*/
BBS_PUBLIC BOOLEAN c2a_box_w_overlap ( box1, box2, w ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/

C2_BOX box1, box2 ;
REAL w ;
{
    RETURN ( c2ab_box_overlap ( box1, box2, w+BBS_TOL ) ) ;
}


/*-------------------------------------------------------------------------*/
STATIC BOOLEAN c2ab_box_overlap ( box1, box2, tol ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/

C2_BOX box1, box2 ;
REAL tol ;
{
    if ( C2_MAX_X(box1) < C2_MIN_X(box2) - tol ) 
        RETURN ( FALSE ) ;
    if ( C2_MAX_X(box2) < C2_MIN_X(box1) - tol ) 
        RETURN ( FALSE ) ;
    if ( C2_MAX_Y(box1) < C2_MIN_Y(box2) - tol ) 
        RETURN ( FALSE ) ;
    if ( C2_MAX_Y(box2) < C2_MIN_Y(box1) - tol ) 
        RETURN ( FALSE ) ;
    RETURN ( TRUE ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX   c2a_box_poly ( a, d, box ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 *a  ;          /* Input array */
INT  d ;            /* Number of points */
C2_BOX  box ;
{
    INT i ;

    C2_MIN_X(box) = C2_MAX_X(box) = a[0][0] ;
    C2_MIN_Y(box) = C2_MAX_Y(box) = a[0][1] ;
    
    for ( i=1 ; i<d ; i++ ) {
        if ( a[i][0] < C2_MIN_X(box) )
            C2_MIN_X(box) = a[i][0] ;
        else if ( a[i][0] > C2_MAX_X(box) )
            C2_MAX_X(box) = a[i][0] ;
        if ( a[i][1] < C2_MIN_Y(box) )
            C2_MIN_Y(box) = a[i][1] ;
        else if ( a[i][1] > C2_MAX_Y(box) )
            C2_MAX_Y(box) = a[i][1] ;
    }
    RETURN ( box ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC BOOLEAN c2a_pt_inside ( box, pt, tol ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PT2 pt ;
C2_BOX box ;
REAL tol ;
{
    RETURN ( 
    ( C2_MIN_X(box) - tol <= pt[0] ) && ( C2_MAX_X(box) + tol >= pt[0] ) &&
    ( C2_MIN_Y(box) - tol <= pt[1] ) && ( C2_MAX_Y(box) + tol >= pt[1] ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX c2a_box_init_pt ( box, pt ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
PT2 pt ;
{
    C2_MIN_X(box) = PT2_X(pt) ;
    C2_MAX_X(box) = PT2_X(pt) ;
    C2_MIN_Y(box) = PT2_Y(pt) ;
    C2_MAX_Y(box) = PT2_Y(pt) ;
    RETURN ( box ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX c2a_box_append_pt ( box, pt ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
PT2 pt ;
{
    if ( PT2_X(pt) < C2_MIN_X(box) ) 
        C2_MIN_X(box) = PT2_X(pt) ;
    else if ( PT2_X(pt) > C2_MAX_X(box) ) 
        C2_MAX_X(box) = PT2_X(pt) ;
    if ( PT2_Y(pt) < C2_MIN_Y(box) ) 
        C2_MIN_Y(box) = PT2_Y(pt) ;
    else if ( PT2_Y(pt) > C2_MAX_Y(box) ) 
        C2_MAX_Y(box) = PT2_Y(pt) ;
    RETURN ( box ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX c2a_box_append ( box, append_box ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box, append_box ;
{
    if ( C2_MIN_X(append_box) < C2_MIN_X(box) ) 
        C2_MIN_X(box) = C2_MIN_X(append_box) ;
    if ( C2_MAX_X(append_box) > C2_MAX_X(box) ) 
        C2_MAX_X(box) = C2_MAX_X(append_box) ;
    if ( C2_MIN_Y(append_box) < C2_MIN_Y(box) ) 
        C2_MIN_Y(box) = C2_MIN_Y(append_box) ;
    if ( C2_MAX_Y(append_box) > C2_MAX_Y(box) ) 
        C2_MAX_Y(box) = C2_MAX_Y(append_box) ;
    RETURN ( box ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX c2a_box_copy ( box0, box1 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box0, box1 ;
{
    C2_MIN_X(box1) = C2_MIN_X(box0) ;
    C2_MAX_X(box1) = C2_MAX_X(box0) ;
    C2_MIN_Y(box1) = C2_MIN_Y(box0) ;
    C2_MAX_Y(box1) = C2_MAX_Y(box0) ;
    RETURN ( box1 ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX c2a_box_union ( box1, box2, box ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box1, box2, box ;
{
    C2_MIN_X(box) = ( C2_MIN_X(box1) < C2_MIN_X(box2) ) ? 
        C2_MIN_X(box1) : C2_MIN_X(box2) ;
    C2_MAX_X(box) = ( C2_MAX_X(box1) < C2_MAX_X(box2) ) ?
        C2_MAX_X(box2) : C2_MAX_X(box1) ;

    C2_MIN_Y(box) = ( C2_MIN_Y(box1) < C2_MIN_Y(box2) ) ? 
        C2_MIN_Y(box1) : C2_MIN_Y(box2) ;
    C2_MAX_Y(box) = ( C2_MAX_Y(box1) < C2_MAX_Y(box2) ) ?
        C2_MAX_Y(box2) : C2_MAX_Y(box1) ;
    RETURN ( box ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PUBLIC C2_BOX c2a_box_inflate ( box, w ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
C2_BOX box ;
REAL w ;
{
    C2_MIN_X(box) -= w ;
    C2_MAX_X(box) += w ;
    C2_MIN_Y(box) -= w ;
    C2_MAX_Y(box) += w ;
    RETURN ( box ) ;
}

#ifdef   SPLINE

/*-------------------------------------------------------------------------*/
BBS_PRIVATE C2_BOX c2a_box_hpoly ( a, d, box ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                   All rights reserved                    !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
HPT2 *a  ;          /* Input array */
INT  d ;            /* Number of points */
C2_BOX  box ;
{
    REAL z ;
    INT i ;

    if ( HPT2_INF(a[0]) || HPT2_INF(a[d-1]) )
        RETURN ( NULL ) ;

    C2_MIN_X(box) = C2_MAX_X(box) = HPT2_X(a[0]) ;
    C2_MIN_Y(box) = C2_MAX_Y(box) = HPT2_Y(a[0]) ;
    
    for ( i=1 ; i<d ; i++ ) {
        if ( HPT2_INF(a[i]) )
            RETURN ( NULL ) ;
        z = HPT2_X(a[i]) ;
        if ( z < C2_MIN_X(box) )
            C2_MIN_X(box) = z ;
        else if ( z > C2_MAX_X(box) )
            C2_MAX_X(box) = z ;
        z = HPT2_Y(a[i]) ;
        if ( z < C2_MIN_Y(box) )
            C2_MIN_Y(box) = z ;
        else if ( z > C2_MAX_Y(box) )
            C2_MAX_Y(box) = z ;
    }
    RETURN ( box ) ;
}
#endif   /*SPLINE*/

