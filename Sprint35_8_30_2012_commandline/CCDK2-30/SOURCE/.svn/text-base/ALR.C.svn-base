/* -2 -3 */
/********************************** ALR.C **********************************/
/*********************** Processing d_arc information **********************/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                         !!!!!!!!*/
/*!!!!!!!! (C) Copyright 1989 - 1995 Building Block Software  !!!!!!!!*/
/*!!!!!!!!                    All rights reserved                  !!!!!!!!*/ 
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/ 

#include <alrdefs.h>

/*-------------------------------------------------------------------------*/
BBS_PRIVATE REAL alr_parm ( angle, d ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
REAL angle, d ;
{
    REAL c, s ;
    c = cos ( 0.5 * angle ) ;
    s = sin ( 0.5 * angle ) ;
    RETURN ( 0.5 * ( 1.0 + d * d ) * s / ( d * ( d * s + c ) ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE REAL alr_angle ( t, d ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
REAL t, d ;
{
    REAL c, s, w, d2, u, u2 ;
    d2 = d * d ;
    u = 1.0 - 2.0 * t ;
    u2 = u * u ;
    w = ( 1.0 + d2 ) * ( 1.0 + d2 * u2 ) ;
    c = 1.0 - 8.0 * d2 * t * t / w ;
    s = 4.0 * d * t * ( 1.0 + d2 * u ) / w ;
    RETURN ( bbs_atan2 ( s, c ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE void alr_parm_set ( parm )
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
PARM parm ;
{
    PARM_J(parm) = (INT) PARM_T(parm) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE REAL alr_sbdv_d ( d ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
REAL d ;
{
    RETURN ( d / ( sqrt ( d * d + 1.0 ) + 1.0 ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE REAL alr_trim_d ( d, t0, t1 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
REAL d, t0, t1 ;
{
    REAL d2, u0, u1, w0, w1, w ;

    d2 = d * d ;
    u0 = 2.0 * t0 - 1.0 ;
    u1 = 2.0 * t1 - 1.0 ;
    w0 = 1.0 + d2 * u0 * u0 ;
    w  = 1.0 + d2 * u0 * u1 ;
    w1 = 1.0 + d2 * u1 * u1 ;
    RETURN ( d * ( u1 - u0 ) / ( sqrt ( w0 * w1 ) + w ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE REAL alr_trim_parm ( d, t, t0, t1 ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
REAL d, t, t0, t1 ;
{
    REAL d2, u0, u1, w0, w1 ;

    d2 = d * d ;
    u0 = 2.0 * t0 - 1.0 ;
    u1 = 2.0 * t1 - 1.0 ;
    w0 = ( 1.0 - t ) / sqrt ( 1.0 + d2 * u0 * u0 ) ;
    w1 = t / sqrt ( 1.0 + d2 * u1 * u1 ) ;
    RETURN ( ( t0 * w0 + t1 * w1 ) / ( w0 + w1 ) ) ;
}


/*-------------------------------------------------------------------------*/
BBS_PRIVATE REAL alr_sweep ( d ) 
/*-------------------------------------------------------------------------*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
/*!!!!!!!!                                                          !!!!!!!*/
/*!!!!!!!!      (C) Copyright 1989 - 1995 Building Block Software   !!!!!!!*/
/*!!!!!!!!                    All rights reserved                   !!!!!!!*/
/*!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!*/
REAL d ;
{
    RETURN ( 4.0 * atan ( d ) ) ;
}

